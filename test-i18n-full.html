<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç I18N - –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #a0aec0;
        }

        .test-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .test-item.success {
            border-left-color: #48bb78;
        }

        .test-item.error {
            border-left-color: #f56565;
        }

        .test-item.warning {
            border-left-color: #ecc94b;
        }

        .test-icon {
            font-size: 1.5rem;
            margin-right: 12px;
        }

        .test-content {
            flex: 1;
        }

        .test-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .test-description {
            font-size: 0.9rem;
            color: #a0aec0;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #a0aec0;
            font-size: 0.9rem;
        }

        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin: 10px 5px;
        }

        .test-button:hover {
            transform: translateY(-2px);
        }

        .test-button:active {
            transform: translateY(0);
        }

        .translation-test {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }

        .translation-test h3 {
            margin-bottom: 10px;
            color: #a0aec0;
        }

        .translation-examples {
            display: grid;
            gap: 10px;
        }

        .translation-example {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-family: monospace;
        }

        .translation-key {
            color: #f6ad55;
            font-weight: 600;
        }

        .translation-value {
            color: #68d391;
            margin-left: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏–º —Å—Ç–∏–ª–∏ lang-switcher –¥–ª—è —Ç–µ—Å—Ç–∞ */
        .lang-switcher {
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(10px) !important;
            padding: 10px 15px !important;
            border-radius: 8px !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            z-index: 10000 !important;
        }

        .lang-switcher select {
            background: rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            padding: 8px 12px !important;
            border-radius: 6px !important;
            font-size: 14px !important;
            font-weight: 600 !important;
            cursor: pointer !important;
        }

        .lang-switcher select option {
            background: #1e1e2e !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã i18n</h1>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalTests">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="passedTests" style="color: #48bb78;">0</div>
                <div class="stat-label">–£—Å–ø–µ—à–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="failedTests" style="color: #f56565;">0</div>
                <div class="stat-label">–û—à–∏–±–æ–∫</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="warningTests" style="color: #ecc94b;">0</div>
                <div class="stat-label">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π</div>
            </div>
        </div>

        <div style="text-align: center; margin-bottom: 20px;">
            <button class="test-button" onclick="runAllTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <button class="test-button" onclick="testLanguageSwitching()">üåê –¢–µ—Å—Ç —Å–º–µ–Ω—ã —è–∑—ã–∫–∞</button>
            <button class="test-button" onclick="clearCache()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à</button>
        </div>

        <div id="testResults"></div>

        <div class="translation-test">
            <h3>üìù –ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (—Ç–µ–∫—É—â–∏–π —è–∑—ã–∫: <span id="currentLang">ru</span>)</h3>
            <div class="translation-examples">
                <div class="translation-example">
                    <span class="translation-key" data-i18n="nav.exchange">nav.exchange</span>
                    <span class="translation-value" id="trans-nav-exchange">‚Äî</span>
                </div>
                <div class="translation-example">
                    <span class="translation-key" data-i18n="nav.mev">nav.mev</span>
                    <span class="translation-value" id="trans-nav-mev">‚Äî</span>
                </div>
                <div class="translation-example">
                    <span class="translation-key" data-i18n="nav.arbitrage">nav.arbitrage</span>
                    <span class="translation-value" id="trans-nav-arbitrage">‚Äî</span>
                </div>
                <div class="translation-example">
                    <span class="translation-key" data-i18n="meta.title">meta.title</span>
                    <span class="translation-value" id="trans-meta-title">‚Äî</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="i18n.js"></script>
    <script src="lang-switcher.js"></script>

    <script>
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            warning: 0
        };

        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
            document.getElementById('warningTests').textContent = testStats.warning;
        }

        function addTestResult(title, description, status) {
            testStats.total++;
            if (status === 'success') testStats.passed++;
            else if (status === 'error') testStats.failed++;
            else if (status === 'warning') testStats.warning++;

            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };

            const resultsDiv = document.getElementById('testResults');
            const section = resultsDiv.querySelector('.test-section') || document.createElement('div');
            
            if (!section.classList.contains('test-section')) {
                section.className = 'test-section';
                section.innerHTML = '<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</h2>';
                resultsDiv.appendChild(section);
            }

            const testItem = document.createElement('div');
            testItem.className = `test-item ${status}`;
            testItem.innerHTML = `
                <div class="test-icon">${icons[status]}</div>
                <div class="test-content">
                    <div class="test-title">${title}</div>
                    <div class="test-description">${description}</div>
                </div>
            `;
            section.appendChild(testItem);
            updateStats();
        }

        async function runAllTests() {
            // –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            document.getElementById('testResults').innerHTML = '';
            testStats = { total: 0, passed: 0, failed: 0, warning: 0 };
            updateStats();

            addTestResult('–ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', '–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã i18n...', 'info');

            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ I18N
            if (window.I18N) {
                addTestResult('–û–±—ä–µ–∫—Ç I18N', '–ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç window.I18N —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'success');
            } else {
                addTestResult('–û–±—ä–µ–∫—Ç I18N', '–û–®–ò–ë–ö–ê: window.I18N –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                return;
            }

            // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —è–∑—ã–∫–æ–≤
            const availableLocales = window.I18N.AVAILABLE_LOCALES || [];
            addTestResult(
                '–î–æ—Å—Ç—É–ø–Ω—ã–µ —è–∑—ã–∫–∏',
                `–ù–∞–π–¥–µ–Ω–æ ${availableLocales.length} —è–∑—ã–∫–æ–≤: ${availableLocales.join(', ')}`,
                availableLocales.length > 0 ? 'success' : 'error'
            );

            // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –ª–æ–∫–∞–ª–µ–π
            let localesFound = 0;
            let localesMissing = [];
            
            for (const lang of availableLocales) {
                try {
                    const res = await fetch(`./locales/${lang}.json`);
                    if (res.ok) {
                        localesFound++;
                    } else {
                        localesMissing.push(lang);
                    }
                } catch (e) {
                    localesMissing.push(lang);
                }
            }

            if (localesMissing.length === 0) {
                addTestResult(
                    '–§–∞–π–ª—ã –ª–æ–∫–∞–ª–µ–π',
                    `–í—Å–µ ${localesFound} —Ñ–∞–π–ª–æ–≤ –ª–æ–∫–∞–ª–µ–π –Ω–∞–π–¥–µ–Ω—ã`,
                    'success'
                );
            } else {
                addTestResult(
                    '–§–∞–π–ª—ã –ª–æ–∫–∞–ª–µ–π',
                    `–û–®–ò–ë–ö–ê: –ù–µ –Ω–∞–π–¥–µ–Ω—ã —Ñ–∞–π–ª—ã –¥–ª—è —è–∑—ã–∫–æ–≤: ${localesMissing.join(', ')}`,
                    'error'
                );
            }

            // –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–æ–≤ (—Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –≤ —à–∞–ø–∫–µ)
            const headerHolder = document.getElementById('languageSelector');
            if (!headerHolder) {
                addTestResult(
                    '–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤',
                    '–ù–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ #languageSelector –≤ —Ä–∞–∑–º–µ—Ç–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã',
                    'warning'
                );
            } else {
                // –î–∞—ë–º –≤—Ä–µ–º–µ–Ω–∏ —Å–∫—Ä–∏–ø—Ç—É lang-switcher.js —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å select
                await new Promise(r => setTimeout(r, 300));
                const select = headerHolder.querySelector('select.header-lang-select');
                const options = select ? select.querySelectorAll('option') : [];
                addTestResult(
                    '–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤',
                    select ? `–ù–∞–π–¥–µ–Ω –≤ —à–∞–ø–∫–µ, –æ–ø—Ü–∏–π: ${options.length}` : '–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –µ—Å—Ç—å, –Ω–æ select –Ω–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω',
                    select && options.length > 0 ? 'success' : 'warning'
                );
            }

            // –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å data-i18n
            const i18nElements = document.querySelectorAll('[data-i18n]');
            addTestResult(
                '–≠–ª–µ–º–µ–Ω—Ç—ã data-i18n',
                `–ù–∞–π–¥–µ–Ω–æ ${i18nElements.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞`,
                i18nElements.length > 0 ? 'success' : 'warning'
            );

            // –¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞
            const currentLang = window.I18N.current || localStorage.getItem('i18n:lang') || 'unknown';
            addTestResult(
                '–¢–µ–∫—É—â–∏–π —è–∑—ã–∫',
                `–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —è–∑—ã–∫: ${currentLang}`,
                currentLang !== 'unknown' ? 'success' : 'error'
            );
            document.getElementById('currentLang').textContent = currentLang;

            // –¢–µ—Å—Ç 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–≤–∞—Ä—è
            try {
                const dict = await window.I18N.loadDict(currentLang);
                const keysCount = Object.keys(dict).length;
                addTestResult(
                    '–°–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–≤–æ–¥–æ–≤',
                    `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${keysCount} –∫–ª—é—á–µ–π –ø–µ—Ä–µ–≤–æ–¥–∞ –¥–ª—è —è–∑—ã–∫–∞ ${currentLang}`,
                    keysCount > 0 ? 'success' : 'error'
                );

                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤
                document.getElementById('trans-nav-exchange').textContent = dict['nav.exchange'] || '‚Äî';
                document.getElementById('trans-nav-mev').textContent = dict['nav.mev'] || '‚Äî';
                document.getElementById('trans-nav-arbitrage').textContent = dict['nav.arbitrage'] || '‚Äî';
                document.getElementById('trans-meta-title').textContent = dict['meta.title'] || '‚Äî';
            } catch (e) {
                addTestResult(
                    '–°–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–≤–æ–¥–æ–≤',
                    `–û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å - ${e.message}`,
                    'error'
                );
            }

            // –¢–µ—Å—Ç 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ meta —Ç–µ–≥–æ–≤
            const metaLang = document.documentElement.getAttribute('lang');
            addTestResult(
                'Meta —Ç–µ–≥ lang',
                `–ê—Ç—Ä–∏–±—É—Ç lang —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${metaLang}`,
                metaLang ? 'success' : 'warning'
            );

            addTestResult('–ó–∞–≤–µ—Ä—à–µ–Ω–æ', `–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –£—Å–ø–µ—à–Ω–æ: ${testStats.passed}, –û—à–∏–±–æ–∫: ${testStats.failed}, –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π: ${testStats.warning}`, 'info');
        }

        async function testLanguageSwitching() {
            const availableLocales = window.I18N.AVAILABLE_LOCALES || [];
            if (availableLocales.length === 0) {
                alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —è–∑—ã–∫–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!');
                return;
            }

            addTestResult('–¢–µ—Å—Ç —Å–º–µ–Ω—ã —è–∑—ã–∫–∞', '–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —è–∑—ã–∫–∞–º–∏...', 'info');

            for (let i = 0; i < Math.min(3, availableLocales.length); i++) {
                const lang = availableLocales[i];
                try {
                    await window.I18N.set(lang);
                    await new Promise(resolve => setTimeout(resolve, 500)); // –î–∞—ë–º –≤—Ä–µ–º—è –Ω–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
                    
                    const currentLang = document.documentElement.getAttribute('lang');
                    if (currentLang === lang) {
                        addTestResult(
                            `–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ ${lang}`,
                            `–Ø–∑—ã–∫ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ ${lang}`,
                            'success'
                        );
                    } else {
                        addTestResult(
                            `–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ ${lang}`,
                            `–û–®–ò–ë–ö–ê: –Ø–∑—ã–∫ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è (–æ–∂–∏–¥–∞–ª—Å—è: ${lang}, –ø–æ–ª—É—á–µ–Ω: ${currentLang})`,
                            'error'
                        );
                    }
                } catch (e) {
                    addTestResult(
                        `–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ ${lang}`,
                        `–û–®–ò–ë–ö–ê: ${e.message}`,
                        'error'
                    );
                }
            }
        }

        function clearCache() {
            localStorage.clear();
            addTestResult('–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞', 'LocalStorage –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'info');
            setTimeout(() => location.reload(), 1000);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(runAllTests, 1000);
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞
        if (window.I18N && window.I18N.on) {
            window.I18N.on('change', async (lang) => {
                document.getElementById('currentLang').textContent = lang;
                try {
                    const dict = await window.I18N.loadDict(lang);
                    document.getElementById('trans-nav-exchange').textContent = dict['nav.exchange'] || '‚Äî';
                    document.getElementById('trans-nav-mev').textContent = dict['nav.mev'] || '‚Äî';
                    document.getElementById('trans-nav-arbitrage').textContent = dict['nav.arbitrage'] || '‚Äî';
                    document.getElementById('trans-meta-title').textContent = dict['meta.title'] || '‚Äî';
                } catch (e) {
                    console.error('Failed to update translations:', e);
                }
            });
        }
    </script>
</body>
</html>
